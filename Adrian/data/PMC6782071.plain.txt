Genotyping of Transcriptomes links somatic mutations and cell identity Abstract
Defining the transcriptomic identity of malignant cells is challenging in the absence of surface markers that distinguish cancer clones from one another or from admixed non-neoplastic cells. To address this challenge, we developed Genotyping of Transcriptomes (GoT), integrating genotyping with high-throughput droplet-based single-cell RNA-seq. We applied GoT to study how somatic mutations corrupt the complex process of human hematopoiesis, profiling 38,290 CD34+ cells from patients with CALR-mutated myeloproliferative neoplasms (MPN). High-resolution mapping of malignant vs. normal hematopoietic progenitors revealed increasing CALR-mutation fitness advantage with myeloid differentiation. We identified the unfolded protein response as a predominant outcome of CALR mutations, with significant cell identity dependency, as well as NF-κB pathway upregulation specifically in uncommitted stem cells. We further extended the GoT toolkit to genotype multiple targets and loci distant from transcript ends. Collectively, these findings revealed that the transcriptional output of MPN somatic mutations is dependent on the native cell identity. # RESULTS ## Genotyping of Transcriptomes (GoT) couples targeted cDNA genotyping with single-cell whole transcriptomes to reveal that CALR mutant progenitor cells are comingled with wildtype cells throughout differentiation To link genotypes to single-cell RNA-seq (scRNA-seq) in high-throughput droplet-based platforms, we modified the 10x Genomics platform (Pleasanton, CA) to amplify the targeted transcript and locus of interest (Methods, Fig. 1a, Extended Data Fig. 1b,c). We then interrogated amplicon reads for mutational status, and linked the genotype to single-cell gene expression profiles via shared cell barcodes (Extended Data Fig. 2a,b). We tested the ability of GoT to co-map single-cell genotypes and transcriptomes with a species-mixing experiment, wherein mouse cells with a mutant CALR transgene were mixed with human cells with a wildtype CALR transgene (Fig. 1b)12. Consistent with precision genotyping, the vast majority of cells with mouse transcripts showed mutant CALR, whereas cells with human transcripts showed wildtype CALR (96.7% of cells matching the expected species; Fig. 1b, Extended Data Fig. 2c–g). While CALR mutations have been demonstrated to activate MPL resulting in megakaryocytic proliferation7,12–16, how the mutations perturb early hematopoietic stem progenitor cell (HSPC) differentiation is largely unknown. We therefore applied GoT to CD34+ bone marrow cells from five patients with CALR-mutated essential thrombocythemia (ET), not treated with disease-modifying therapy at the time of biopsy (Supplementary Table 1). CALR genotyping data were available for 16,614 of 18,722 cells (88.7%), compared to only 1.4% by interrogation of CALR in the conventional 10x Genomics data (Fig. 1c, Extended Data Fig. 3a–d). To interrogate the cellular identities of these progenitors, we performed clustering agnostic to the genotyping information, based on the transcriptome information alone (Fig. 1d, Extended Data Fig. 4a–c)17,18. Genotype projection onto progenitor maps demonstrated that mutated cells involved all CD34+ stem and progenitor clusters, consistent with previous bulk PCR analysis of CALR in FACS-sorted CD34+ subsets6 (Fig. 1e, see Extended Data Fig. 4d,e for validation with an alternative clustering framework19). Notably, mutated cells did not form novel independent clusters, confirming that scRNA-seq alone cannot distinguish mutant from wildtype cells, and demonstrating that CALR mutations in ET impact the entire hematopoietic differentiation hierarchy. ## The fitness impact of CALR mutations increases with myeloid differentiation, associated with increased proliferation in mutant progenitors While mutant cells were observed across all progenitor clusters, their frequencies varied between clusters. CALR mutated cell frequency was higher in committed myeloid progenitors (Fig. 1f), especially MkPs which are closely associated with the disease phenotype of elevated platelets, compared to uncommitted HSPC clusters across samples (P-value <10−10, linear mixed model, Fig. 1g, Extended Data Fig. 5a). Consistently, pseudo-temporal ordering (pseudotime) analysis20,21 showed that CALR mutated cells were enriched in cells with later pseudotime points compared to wildtype cells (Fig. 1h,i, P-value <10−10, linear mixed model, Extended Data Fig. 5b,c). We orthogonally validated this finding via bulk gDNA droplet digital PCR, showing a lower CALR variant allele frequency (VAF) in CD34+CD38− HSPCs compared to CD34+CD38+ progenitors (P-value = 0.02, Wilcoxon rank-sum test, Fig. 1j). Thus, while CALR mutations arise in uncommitted HSCs and, therefore, propagate to populate the entire differentiation tree, the impact of CALR mutations on fitness increases with myeloid differentiation (Extended Data Fig. 5d,e). GoT uniquely enables direct transcriptional program comparison between mutant and wildtype cells, not only within the same sample, but also within the same progenitor cluster. For example, CALR-mutated progenitors displayed increased expression of genes upregulated in progenitors from JAK2-mutated ET22, most significantly in MkP clusters (combined P-value <10−10, Fisher’s method, Fig. 2a,b), as JAK2 and CALR mutations partially converge through activation of similar downstream pathways23. We therefore reasoned that progenitor subtype-specific comparison of cell-cycle gene expression (Supplementary Table 2)24 in mutant vs. wildtype cells may reveal whether the lower fitness impact of CALR mutations in HSPCs compared with MkPs stems from differences in cell proliferation. Indeed, while mutant HSPCs exhibited only a modest increase in cell cycle gene expression compared to wildtype (P-value = 0.015, Wilcoxon rank-sum test, mean fold change 1.2, 95% confidence interval, 1.1–1.4), mutant MkPs demonstrated a robust increase in cell cycle expression vs. their wildtype counterparts (P-value = 4.4 × 10−4, Wilcoxon rank-sum test, fold change 1.8 [1.4–2.8]; Fig. 2c, Extended Data Fig. 6a). Notably, the degree of cell cycle gene expression increase in mutant MkPs correlated with the patients’ platelet counts (Fig. 2d), suggesting that interrogation of the early progenitor cells may correlate with clinical phenotypes and inform our understanding of patient-to-patient variability despite shared mutated genotypes. Cell-to-cell variation exists even within progenitor clusters. For example, MkPs represent a heterogeneous population composed of less differentiated cells with higher expression of HSC genes25 (HSChiMkPlo), and more committed MkP cells displaying high expression of MkP-related genes26 (HSCloMkPhi; Fig. 2e, Supplementary Table 2). Even within the MkP cluster, HSCloMkPhi cells showed increased cell cycle gene expression, and a higher mutant cell frequency compared to HSChiMkPlo cells (P-value = 0.01, Fisher’s exact test). Similarly, mutant cells within the platelet-primed HSPCs (MkPhiTGFβlo) had higher cell cycle gene expression than wildtype MkPhiTGFβlo HSPCs, whereas mutant and wildtype HSPCs in a more quiescent state (MkPloTGFβhi) showed no cell cycle difference (Fig. 2f). These findings further emphasize that the impact of CALR mutation is dependent on cell state, and imparts a greater proliferative advantage in more differentiated cells. These data also reveal that CALR mutations skew differentiation toward myeloid progenitors, including megakaryocytic priming, early in hematopoiesis (Extended Data Fig. 6b). ## De novo differential expression analysis reveals cell identity dependent upregulation of the unfolded protein response in CALR-mutant cells GoT data further offer a unique opportunity for de novo differential gene expression discovery, by examining wildtype vs. mutant cells within the same progenitor subset. Crucially, the wildtype cells serve as an ideal comparison set, as they share all potential environmental and patient-specific variables as the mutated cells. We identified 198 genes to be differentially expressed between mutant and wildtype MkPs (FDR adjusted P-value < 0.1; Fig. 3a, Supplementary Table 3). Mutated MkPs upregulated HSPA5 that encodes BiP, a key player in protein quality control that modulates the activities of the three transmembrane transducers of the unfolded protein response (UPR): PERK, IRE1, and ATF627. Consistently, CALR-mutant MkPs showed upregulation of UPR genes (adjusted P-value 1.7 × 10−8) and ATF6-mediated activation of chaperone genes (adjusted P-value = 0.03, Fig. 3a, Supplementary Table 4), providing direct in vivo validation of in vitro studies that have shown increased UPR in CALR mutated cells28,29. UPR in this context may signal ER stress in response to misfolded proteins, as the CALR chaperone activity may be compromised by the mutation30,31. Notably, among 20 differentially expressed genes in mutant HSPCs, XBP1, an important regulator of UPR, was upregulated in mutant cells suggesting that UPR activation by CALR mutations extends to uncommitted progenitors (Fig. 3b), further supported by upregulation of ATF6-target genes in mutant compared to wildtype HSPCs (Fig. 3c, Extended Data Fig. 7, Supplementary Table 2)32. UPR was previously demonstrated to be preferentially mediated in HSPCs through PERK resulting in enhanced apoptosis upon ER stress33, helping to eliminate ER stressed cells from the HSC pool. In contrast, committed progenitors have a robust IRE1/XBP1 activity, promoting survival through ER stress challenge33. We observed that in the specific context of CALR mutation-induced ER stress, the PERK-branch of the UPR was not enhanced (Fig. 3c, Extended Data Fig. 7, Supplementary Table 2)33. In contrast, targets of XBP1 were upregulated in mutant MkPs (P-value = 5.3 × 10−10, linear mixed model), as well as in mutant HSPCs (P-value = 1.9 × 10−6, linear mixed model, Fig. 3c, Extended Data Fig. 7, Supplementary Table 2)34,35. As IRE1 catalyzes the unconventional splicing of XBP1 unspliced mRNA (XBP1u) into the active spliced form (XBP1s; Fig. 3d)36, we further validated that CALR mutations induce activation of the IRE1-branch of the UPR by repurposing GoT to probe for the spliced region of XBP1 in single cells. CALR mutations robustly augmented the amount of XBP1s in MkPs (Fig. 3e). Remarkably, CALR mutations also resulted in enhanced XBP1s/XBP1u ratio in HSPCs, indicating IRE1 activity (Fig. 3e). These data thus suggest that in CALR mutation-induced UPR, IRE1 is activated in both HSPCs and MkPs, skewing the ER stress-challenged stem and progenitor cells toward survival. Differential gene expression analysis in HSPCs also revealed upregulation of the NF-κB pathway (adjusted P-value = 0.03), including upregulation of CXCL2 and NFKBIA (Fig. 3b, Supplementary Tables 3 and 4). Furthermore, NF-κB gene set upregulation in mutant vs. wildtype HSPCs was most notable in early uncommitted HSPCs (Fig. 3f, Supplementary Table 2). Mutant cells in this early HSPC subcluster also upregulated anti-apoptotic related genes (Fig. 3f, Supplementary Table 2). As NF-κB pathway activation has been previously associated with anti-apoptotic effects37 and HSC self-renewal38, our data thus points at another potential mechanism linking CALR mutation and HSC outgrowth. ## IRE1-mediated UPR by mutant CALR is maintained through progression to myelofibrosis As a proportion of patients with CALR-mutated ET eventually progresses to post-ET myelofibrosis (MF) or present initially with MF, we examined whether CALR mutation imparted similar proliferative and survival advantage to progenitor cells from patients with CALR-mutated MF by examining 9,704 genotyped cells of total 11,093 cells (87.5% genotyping rate) across four MF samples (Fig. 4a,b, Extended Data Fig. 8a). In contrast to ET, we did not observe enrichment of mutated cells in differentiated progenitors compared to HSPCs (Fig. 4c, Extended Data Fig. 8b), consistent with previous reports39, suggesting that in the context of MF, CALR mutations impart a strong fitness advantage even to HSPCs. Indeed, mutant cells were highly enriched in cell cycle activity (Fig. 4d, Extended Data Fig. 8c). As megakaryocytes have been demonstrated to play a principle role in the development of marrow fibrosis40, we performed differential expression analysis between mutant and wildtype MkPs, showing 92 differentially expressed genes (FDR adjusted P-value < 0.1, Fig. 4e, Supplementary Table 3). We identified upregulation of TGFB1, previously implicated in fibroblast stimulation by megakaryocytes41,42, thereby demonstrating that TGFβ production is dysregulated even in early progenitors. Indeed, TGFβ signaling upregulation in mutant MkPs correlated with the degree of fibrosis in the patient’s bone marrow (Extended Data Fig. 8d). As in CALR-mutated ET, we observed a robust upregulation of UPR genes in mutated MkPs (adjusted P-value = 4.7 × 10−7) and, specifically, IRE1 activation (adjusted P-value = 0.0017; Fig. 4e, Supplementary Table 4). Notably, comparison of cycling to non-cycling wildtype cells did not show UPR upregulation, affirming that UPR activation is not simply a byproduct of increased proliferation (Extended Data Fig. 8e, Supplementary Tables 3 and 4). These findings suggest that the enhanced survival of CALR-mutant progenitors through upregulation of the IRE1-mediated UPR is maintained through disease progression to myelofibrosis. ## Multiplexed GoT reveals subclonal transcriptomic identities Ongoing clonal evolution results in multi-clonal malignant populations, requiring genotyping of multiple mutations in parallel. To test the ability of GoT to target multiple mutations, we targeted three mutations affecting CALR (VAF 43.5% by bulk exon sequencing), NFE2 (VAF 33%) and SF3B1 (VAF 47.5%) in 8,475 CD34+ cells from a patient with MF (Fig. 5a). The relative VAFs of these mutations suggest that this malignancy follows a nested (linear evolution) clonal structure, with a clonal SF3B1 mutation, a progeny subclone harboring a CALR mutation, which has an additional NFE2-mutated progeny (single-cell cloning validation in Extended Data Fig. 9a). GoT provided genotyping for CALR and NFE2 in 74% and 60% of cells, respectively, and showed mutant frequencies (64% and 56%, respectively) comparable to those of single cell cloning (85% and 71%, respectively, performed with unsorted peripheral blood cells). In this context, GoT allows to compare the transcriptional outputs of the different mutations alone or in combination. For example, since SF3B1 mutations have been shown to block erythroid maturation43, we examined whether the addition of a CALR mutation would still confer increased proliferative status in megakaryocytic-erythroid progenitors. We found that SF3B1/CALR-double mutants exhibited increased proliferative advantage over SF3B1-single mutants (Fig. 5b), while the addition of NFE2 mutation (triple-mutant) did not further increase cell cycle activation. Thus, multiplexed GoT demonstrated the ability to interrogate complex clonal structures, as well as the need to assess the combinatorial transcriptional output of mutations in the context of high-resolution cell identity mapping. ## Circularization GoT enables genotyping of mutations distant from transcript ends GoT amplicon recovery is not only dependent on the expression level of the gene but also on the distance of the mutation locus from transcript ends (Extended Data Fig. 9b). Capture efficiency of a mutation distant from the 3’ end (>1.5 kb, e.g. SF3B1 genotyping of 9% of cells, Fig. 5a) was lower than for targets closer to the 3’ end. While driver mutations are often found within 1.5 kb of either transcript ends (Extended Data Fig. 9c), loci of interest may reside at larger distances, and thus the dependency on relative proximity to transcript end is limiting. We reasoned that lower genotyping efficiency resulted, at least partially, from the inability of larger amplicon fragments to cluster efficiently on Illumina flow cells during sequencing. We further integrated our protocol with long-read sequencing with nanopore GridION X5 (Oxford Nanopore Technology), which demonstrated that SF3B1 transcripts were captured accurately with our procedure (Extended Data Fig. 9d,e), and further confirmed low intra- and inter-transcript PCR recombination rate, even for these relatively large fragments (Extended Data Fig. 9f,g). To overcome this limitation, we applied sequential rounds of circularization and inverse PCR to remove the intervening sequence between the region of interest and the cell barcode (Fig. 5c). Circularization GoT showed high concordance with un-circularized (linear) GoT for CALR genotyping (Extended Data Fig. 9h,i). When applied to SF3B1 mutation capture, circularization GoT significantly increased the yield of genotyped cells from 750 to 2004 cells (9% to 24% of cells, Fig. 5d,e). These results demonstrate the ability of circularization GoT to extend our reach even to targets distant from gene ends. To further demonstrate the ability of circularization GoT to genotype despite significant distance from the transcript end, we targeted JAK2V617F (~3 kb). We first validated circularization GoT for JAK2 via a mixing experiment with barcoded cDNA from TF1 cell line (wildtype JAK2) and from HEL cells (homozygous JAK2V617F), showing accurate genotype assignment (Fig. 5f). Next, we genotyped primary CD34+ cells from an individual with JAK2V617F ET, obtaining genotyping information for 7.3% of cells (Fig. 5g), even for this very lowly expressed gene. Mutant cell frequency was higher in MkPs compared to HSPCs, whereas the mutant cell frequency remained low in erythroid progenitors (Fig. 5h), concordant with the clinical phenotype of ET, rather than polycythemia vera (disease associated with the same JAK2 mutation, but with erythrocytosis as the leading abnormality). Consistent with this observation, we observed, albeit in a small number of genotyped HSPCs, a trend towards increased MkP-priming in mutant HSPCs (P-value = 0.04, Wilcoxon rank-sum; Fig. 5i, Supplementary Table 2). These data suggest skewing of differentiation toward megakaryopoiesis in HSPCs and may provide insights into the isolated megakaryocytic proliferation in JAK2-mutated ET. # Discussion Here, we present GoT, which co-captures somatic genotypes and transcriptomic identities in thousands of single cells from primary cancer specimens. Building on previous experience for targeted amplification in droplet-based scRNA-seq44,45, GoT overcomes the unique set of challenges presented by somatic mutation genotyping, including lower expression levels and large distances from the end of the sequenced transcripts. Collectively, GoT allowed us to directly interrogate the transcriptional impact of CALR mutation in primary MPN samples, where wildtype cells in the sample provide an ideal comparison set, controlling for patient-specific and technical confounders. We observed that mutant CALR provided a greater fitness advantage through differentiation in ET, associated with higher proliferation in committed myeloid progenitors compared with uncommitted HSPCs. GoT’s ability to fine-map mutant vs. wildtype transcriptional differences in HSPCs revealed upregulation of NF-κB pathway genes in the most undifferentiated mutant HSPCs, supporting a cell-intrinsic role for CALR mutation in NF-κB activation46. We further applied GoT to target the unconventional splice site of XBP1 to demonstrate that IRE1 activity was increased in the mutant cells, including HSPCs. Our data thus nominates the IRE1/XBP1 pathway as a potential therapeutic target for eradication of the mutant clone in the uncommitted HSPCs in patients with CALR-mutated MPNs. In conclusion, high-throughput linking of single-cell genotypic and transcriptomic data underscored the cell identity-dependency of somatic mutations in human hematopoiesis, allowing us to superimpose the native differentiation tree with a tree corrupted by somatic mutations. GoT further provides the means to gain insight into the integration of clonal diversification with lineage plasticity47 or differentiation topologies48 across cancer. Thus, GoT may pave the way to resolve central questions related to the link between genetic mutations and cellular identities, and to unravel the underlying programs that enable clonal expansions and evolution in human neoplasms. # METHODS ## Species mixing experiment Previously published UT7 and Ba/F3 cell lines expressing human MPL and either human wildtype CALR or mutant CALR (type 1, 52 bp deletion), kindly provided by Dr. Mullally’s lab, were used for the species mixing study12. Briefly, human MPL expressing Ba/F3 and UT7 cell lines were generated by retroviral transduction, after which they were subjected to infection with CALR variant lentiviral supernatants. Wildtype UT7 cells and mutant Ba/F3 cells were mixed in equal proportions which underwent GoT, targeting ~1000 cells. While UT7 has been listed as a commonly misidentified cell line, it was used for the sole purpose of validating the CALR mutation status of the cells. All cell lines used in the study were tested for mycoplasma contamination. ## Patient samples The study was approved by the local ethics committee and by the Institutional Review Board (IRB) of Memorial Sloan-Kettering Cancer Center and Weill Cornell Medicine and conducted in accordance to the Declaration of Helsinki protocol. All patients provided informed consent. Cryopreserved bone marrow mononuclear (BMMCs) or peripheral blood mononuclear cells (PBMCs) from patients with documented CALR mutations were retrieved after a database search. See Supplementary Table 1 for clinical information. Cryopreserved BMMCs or PBMCs were thawed and stained using standard procedures (10 min, 4°C) with the surface antibody CD34-PE-Vio770 (clone AC136, lot# 5180718070, dilution 1:50, Miltenyi Biotec) and DAPI (Sigma-Aldrich). Cells were then sorted for DAPI-negative, CD34+ and CD34-negative cells using BD Influx at the Weill Cornell Medicine flow cytometry core. ## Targeted myeloid panel To determine the presence and location of recurrent somatic mutations and their VAF, targeted next-generation sequencing was performed on DNA samples extracted from unfractionated PBMCs (patients ET09, MF01, MF02, MF03, MF04), CD34-negative sorted BMMCs (patients ET02, ET03, ET04, ET05), CD34+ sorted BMMC (patient ET01) and CD34+ sorted PBMC (patient MF05), as previously described49. Briefly, targeted enrichment of 45 genes (ABL1, ASXL1, BCOR, BRAF, CALR, CBL, CEBPA, DNMT3A, ETV6, EZH2, FAM5C, FLT3, GATA1, GATA2, HNRNPK, IDH1, IDH2, IKZF1, JAK1, JAK2, KDM6A, KIT, KRAS, MPL, NFE2, NOTCH1, NPM1, NRAS, PHF6, PTPN11, RAD21, RUNX1, SETBP1, SF3B1, SH2B3, SMC1A, SMC3, SRSF2, STAG2, SUZ12, TET2, TP53, U2AF1, ZRSR2) recurrently mutated in myeloid malignancies was performed using the Thunderstorm system (Raindance Technologies, Billerica, MA) with a custom primer panel followed by sequencing using the Illumina MiSeq (v3 chemistry). ## Genotyping of Transcriptomes (GoT) Extending recent experience with targeted amplicon sequencing in scRNA-seq44,45, we developed GoT in order to simultaneously capture genotyping data and whole transcriptomic data in single cells by adapting the 10x Genomics platform (Pleasanton, CA). The standard 10x Genomics Chromium 3’ (v.2 or v.3 chemistry) and 5’ libraries were carried out according to manufacturer’s recommendations until after emulsion breakage and recovery of first strand cDNA (Fig. 1a, step 1). For 3’ libraries, if the targeted gene of interest, e.g. SF3B1, was not robustly detected by the standard 10x procedure (i.e. if <60% of the expected cells showed expression) based on a priori knowledge in a similar dataset, a gene-specific primer was spiked into 10x primer mix at 1% of the concentration of the cDNA amplification primers for the initial cDNA PCR step (Fig. 1a, see Supplementary Table 5 for list of primers and Extended Data Fig. 1b,c for primer positions). For 5’ libraries, presence of 10X cell barcodes (CB) and UMI on 3’ side of the transcript enabled a gene-specific primer spike-in during the RT step (Guide RT primer: 0.12 μM final concentration, Supplementary Table 5) to increase capture and detection of the transcript of interest (e.g. JAK2). At cDNA amplification step, another spike-in primer (Additive primer) is added to increase yield of the same transcript. During the amplification step, for 3’ libraries v.2 chemistry only, the 10x cDNA library underwent an extra cycle of PCR beyond the manufacturer’s recommended number of cycles. (3’ v3 chemistry and 5’ libraries do not require extra cycles of PCR at amplification step.) After cDNA amplification and cleanup with SPRIselect, a small portion of the cDNA library (3 μL for 3’ v.2 and 10 μl for 3’ v.3 chemistry and 5’ libraries) were aliquoted for targeted genotyping, and the remaining cDNA underwent the standard 10x protocol. In the case of 3’ v.2 chemistry, the cDNA set aside for GoT was amplified for 3 to 4 additional cycles using KAPA HiFi HotStart ReadyMix (KAPABiosystems) and 10x primer mix to provide sufficient material for the enrichment step. After clean-up, locus-specific reverse primers and the generic forward SI-PCR were used to amplify the site of interest of the cDNA template (Extended Data Fig. 1b,c, Supplementary Table 5). Number of PCR cycles was determined experimentally and was dependent on the level of expression of targeted gene (for instance 10 cycles were used for CALR). The locus-specific reverse primers contain a partial Illumina read 2 handle, a stagger to increase the complexity of the library for optimal sequencing and a gene specific region to allow specific priming. The SI-PCR oligo (10x Genomics) anneals to the partial Illumina read 1 sequence at either 3’ or 5’ end of the molecule when using 3’ or 5’ libraries, respectively, preserving the CB and UMI (Extended Data Fig. 1b,c). After the initial amplification and SPRI purification to remove unincorporated primers, a second PCR was performed with a generic forward PCR primer (P5_generic) to retain the CB and UMI together with an RPI-x primer (Illumina) to complete the P7 end of the library and add a sample index. The targeted amplicon library was subsequently spiked into the remainder of the 10x library to be sequenced together on a HiSeq 2500 or sequenced separately on MiSeq (Illumina). The cycle settings were as follows: 26 cycles for read 1, 98 or 130 cycles for read 2, and 8 cycles for sample index for 3’ v.2 chemistry and 5’ libraries, or 28 cycles for read 1, 98 or 130 cycles for read 2, and 8 cycles for sample index for 3’ v.3 chemistry. ## Circularization GoT For patient samples, we used the same starting material as for GoT (i.e. non-fragmented 10x cDNA fraction); for the JAK2 cDNA mixing study, we mixed barcoded cDNA from two cells lines (TF-1: JAK2 wildtype (ATCC CRL-2003), HEL: Homozygote JAK2 V617F (ATCC TIB-180). With these cDNA libraries, we first performed a PCR to enrich for the amplicon, amplifying from ~50 bp upstream our region of interest to the 3’ end of the 10x library fragment, therefore retaining cell barcode (CB) and unique molecule identifier (UMI), using KAPA HiFi Uracil+ master mix (Kapa Biosystems) and the following PCR conditions: 98°C for 3’; 10 to 20 cycles of: 98°C for 20”, 65°C for 30”, 72°C for 2’, 72°C for 5’. Complementary U-overhang are added to the forward (Fw) and reverse (Rv) primers to allow circularization: Fw-primer#1: AGGUCAGTCU-[50bp-upstream-locus-specific], Rv-primer#1: AGACUGACCUCTACACGACGCTCTTCCGATCT (Extended Data Fig. 1b,c, Supplementary Table 5). For genes lowly represented in the cDNA library (such as SF3B1), we specifically pre-enriched the gene of interest by doing a PCR targeting ~100bp upstream our region of interest to the 3’ end of the 10x library fragment, using KAPA HiFi Ready mix (Kapa Biosystems) and the following PCR conditions: 95°C for 3’; 20 cycles of: 98°C for 20”, 65°C for 30”, 72°C for 2’, 72°C for 5’. PCR product resulting from the first single or double PCR was then cleaned-up and concentrated using 1.3X SPRI beads. Next, amplicon cohesive ends were created using 40U/mL USERII enzyme (M5508-NEB) digestion for 1 hour at 37°C in 1X CutSmart buffer. Reaction was stopped by incubating for 10’ at 65°C. Relying on complementary overhang at both end of the amplicon, circularization was performed in a large volume (>1 mL) to favor intra-molecule ligation. The following reaction was set-up and incubated overnight at 16°C: USERII-digested amplicon, 2000 U/mL T4 ligase (NEB), 1X CutSmart Buffer (NEB), 1 mM ATP (Roche). Next, T4 DNA ligase was inactivated by incubating for 15’ at 70°C. Then, unwanted un-ligated products were removed by adding 6U of lambda exonuclease (NEB, M0262S) in the ligation mix and incubating for 30’ at 37°C. Exonuclease was inactivated for 20’ at 65°C. Ligated product was cleaned-up and concentrated using 1.3X SPRI beads. A second PCR was set-up to retain the locus of interest and barcodes on the same molecule while removing the unwanted 3’ downstream region of the targeted region. PCR reaction was set-up and performed as previously described using the following primers: Fw-primer#2: AGGUCAGTCU[3’end-locus-specific], Rv-primer#2: AGACUGACCU[10bp-downstream-locus-specific]. After PCR#2, SPRI clean-up, USERII digestion, overnight T4 ligation, lambda exonuclease digestion were performed as previously described. After the second ligation, the ligated product was again cleaned-up and concentrated using 1.3X SPRI beads. To increase ligation efficiency during the circularization step and also reduce protocol duration (3 days vs 1 day), we further improve ligation by using Gibson assembly molecular cloning approach. Instead of U-overhang handles, complementary Gibson handles are added to the forward (Fw) and reverse (Rv) primers to allow circularization post PCR#1 and PCR#2 (Supplementary Table 5, Extended Data Fig. 1b,c). PCR#1 and PCR#2 are performed as previously described for the U-overhang version of this protocol but using KAPA HiFi Ready mix. Ligation is now perform during 1 hour at 50°C in a large volume (>1 mL, 1X CutSmart Buffer) and using 10 μl of Gibson master mix (NEB, E2611). Finally, to linearize the product of ligation, we performed a third PCR: Fw-primer#3: CCTTGGCACCCGAGAATTCCA[10bp-upstream-specific-locus], Rv-primer#3: SI-PCR (10x Genomics). We used KAPA HiFi master mix (Kapa Biosystems) and the following PCR conditions: 95°C for 3’; 10 cycles of: 98°C for 20”, 65°C for 30”, 72°C for 30”; 72°C for 5’. After SPRI purification, a last PCR was performed with a generic forward PCR primer (P5_generic) and an RPI-x primer (Illumina) to complete the P7 end of the library and add a sample index (95°C for 3’; 5 cycles of: 98°C for 20”, 67°C for 30”, 72°C for 30”; 72°C for 5’). Thus, this method generates amplicons that retain contiguity of the original molecules but are short enough to cluster effectively to be sequenced with standard parameters. The targeted amplicon library was subsequently sequenced using PE150 on MiSeq (Illumina). ## Single-cell RNA-seq data processing, alignment, cell type classification and clustering 10x data was processed using Cell Ranger 2.1.0 with default parameters. Reads were aligned to the human reference sequence GRCh38 or hg19 or to mouse reference mm10 (species mixing experiment). The genomic region of interest for genotyping was examined to determine how many UMIs with targeted sequence were present in the conventional 10x data (Fig. 1c, Extended Data Fig. 3a,b). The Seurat package (v. 3.0) was used to perform unbiased clustering of the CD34+ sorted cells from patient samples18,50. Briefly, for individual datasets, cells with UMI <200 or UMI >3 standard deviation from the mean UMI and mitochondrial gene percentage >10% were filtered. The data was log normalized using a scale factor of 10,000. Prior to clustering, the ET and MF datasets were integrated and underwent batch-correction which implements canonical correlation analysis (CCA) and principles of mutual nearest neighbor. Recommended settings were used for the integration (i.e., 30 canonical correlation vectors for CCA in the FindIntegrationAnchors function and 30 principle components for the anchor weighting procedure in IntegrateData function). For the datasets, potential confounders (e.g., number of UMI per cell and the proportion of mitochondrial genes) were regressed out of the data before principle component analysis (PCA) was performed using variable genes. JackStraw method was used to determine the statistically significant PCs to be used for graph-based clustering. t-SNE was used to visualize the clusters. Clusters were manually assigned based on differentially expressed genes using the FindAllMarkers function using default settings (i.e. using all genes that are detected in a minimum of 25% of cells in either of the two comparison sets as input, and log(fold change) of 0.25 as the threshold). Wilcoxon rank-sum test is applied to rank genes, with the top ten differentially expressed genes per cluster presented in Extended Data Fig. 4b. We identified 19 distinct clusters in the integrated data for ET01-ET05, which were annotated according to marker genes identified by Velten et al.26 (t-distributed stochastic neighbor embedding (t-SNE) in Fig. 1d, and clustering heatmap and t-SNE with representative marker genes in Extended Data Fig. 4b,c). Pseudotime analysis was performed using the Monocle R package (v.3.8) for individual datasets20 and the URD package (v.1.0.2) for the integrated datasets21. Linear mixed effects analysis was performed using the lme4 package (v. 1.2–1). For mutant frequency analysis between HSPCs and MkPs (Fig. 1g), genotype status was defined as the fixed effect and, as random effects, we had intercepts for individual patients (i.e. subjects) and iterative downsampling. For integrated analysis of pseudotime comparison (Fig. 1i) and gene module expression (e.g. Fig. 3c), genotype status was entered as the fixed effect and subjects as random effects. P-values were obtained by likelihood ratio tests of the full model with the fixed effect against the model without the fixed effect51. ## Deep Generative Model for Single Cell Analysis We applied the deep generative modeling approach of Lopez et al. (2018) for the single cell analysis of ET01-ET0519 (Extended Data Fig. 4d,e). Using the scVI package, we trained a variational autoencoder (VAE) that takes as input a feature vector for each cell consisting of transcript counts for the 256 genes with the highest standard deviation across all samples as well as an indicator for batch ID. Using 90% of cells for training and holding out 10% for validation, these features are provided to the VAE with 64-unit hidden layers in both the encoder and decoder modules and a four-dimensional internal latent vector of gaussian-distributed values that provide a more concise representation of biological variability between cells. t-SNE is applied to these vectors for visualization. ## IronThrone GoT: Targeted genotype amplicon sequence processing and mutation calling To ensure correct priming, targeted amplicon reads (read 2) were screened for the presence of the primer sequence and the expected intervening sequence between the primer and the start of the mutation site (‘shared sequence’, for circularization GoT, PCR #2Fw and PCR #2Rv primer sequences; Extended Data Fig. 2a,b). 90.0% of the reads from the mixing study showed the expected primer and shared sequences. Subsequently, for reads that passed the priming step, the corresponding read 1 was screened for the presence of the 16 bp or 18 bp long CB that matched the CB in the whitelist provided by 10x Genomics (Extended Data Fig. 10). For CB reads that were 1-Hamming-distance away from the whitelisted CB, the probability that the observed barcode originated from the whitelisted CB was calculated taking into account the base quality (BQ) score at the differing base. The whitelisted CB with the highest probability was used to replace the observed CB, only if the probability exceeded 0.99. For the duplicate reads with the same CB and UMI, the genotype (wildtype vs. mutant) of the UMI was assigned based on majority rule in supporting reads or according to the read with the highest BQ score in the rare case when only two supporting but discordant reads were available. The species-mixing study for CALR (type 1) mutation was used to further optimize to optimize the analytical assignment of genotypes to cells, to overcome technical sources of noise such as PCR errors, ambient mRNA and PCR recombination, which may accompany targeted amplification in scRNA-seq. A mean (± standard deviation) of 83.6 (± 95.3) CALR UMIs were detected per cell in the amplicon data, with 52 (± 16.3) reads per UMI. We integrated targeted amplicon measures including BQ, number of base pair mismatches, and number of duplicate reads per UMI, and determined optimized parameters that maximize the number of genotyped cells while minimizing genotype mis-assignment (Extended Data Fig. 2c–g). Setting thresholds for the minimum number of duplicate reads and maximum frequency of mismatches contributed significantly to filtering out mis-assigned reads likely due to technical errors (e.g. PCR recombinations). A combination of threshold of two or more duplicate reads for a given UMI and a threshold of allowing less than or equal to 0.2 mismatch ratio significantly improved correct assignment of cells, while maximizing the number of included cells for analysis, and was adopted in the analysis here (Extended Data Fig. 2c). Results of the precision and recall analyses also affirmed this combination of thresholds for minimum duplicate reads and maximum mismatch ratio (Extended Data Fig. 2d). Moreover, given the high number of CALR transcripts in the cell lines and thus higher potential impact of PCR recombination, cells were assigned as wildtype or mutant if >90% of CALR amplicon UMIs were wildtype or mutant, respectively. To further assess the impact of various parameters of the amplicon reads on the precision of mutation calling, we tested these parameters in a random forest classification using the mixing study, as implemented in the R randomForest package (v. ‎4.6–14)52 (Extended Data Fig. 2e–g). Mean decrease accuracy was determined as a measure of importance of each variable used for the calculation of splits in trees (Extended Data Fig. 2e). For each combination of mismatch ratio and duplicate thresholds, random forest was run 100 times to find the optimal number of random variables used in each tree and the minimum out-of-bag error was selected (Extended Data Fig. 2f,g). This random forest analysis also showed a minimum duplicate read threshold of 2 and maximum mismatch ratio threshold of 0.2 to be optimal for minimizing mis-assignments, and the relatively low contribution of additional quality metrics. Moreover, the genotyping information is derived from transcribed molecules and may be affected by the capture of transcripts from wildtype vs. mutant alleles of heterozygous mutations in primary patient samples (in which median targeted amplicon UMI per cell was 5 [± 4.45, median absolute deviation]). This may be due to incomplete sampling of the transcript pool or due to transcriptional bursts53, which leads to skewed transcript pools. Consequently, as the number of UMIs per cell increases, the likelihood of capturing a mutant transcript increases, resulting in an apparently higher frequency of mutated cells. Thus, the number of mutant reads may be underestimated in cells with lower amplicon UMI counts. Nonetheless, the frequency of mutant cells (e.g., 26% in patient sample ET01) as determined by GoT using all cells that harbor at least one UMI yielded values that were similar to that determined by bulk DNA exon sequencing of CALR from CD34+ cells (mutant cell fraction of 30% based on VAF of 0.15 in a diploid heterozygous mutation). While the bulk of the downstream analyses between CALR mutant and wildtype cells used a threshold of two or greater genotyping amplicon UMIs, we systematically applied three approaches to exclude the impact of this confounder (i.e., expression level of target gene) on the conclusions. First, to exclude the possibility that higher CALR expression in committed progenitors can result in greater ability to detect mutant alleles and thereby result in higher mutated cell frequency, we down-sampled all cells to a single amplicon UMI prior to mutation calling and found that the increase in mutation frequencies in MkP compared with HSPC remained unchanged (Fig. 1f). Second, we explored the sensitivity of the difference between mutant and wildtype cells (e.g. pseudotime, mutant cell frequency) by increasing the minimal amplicon UMI threshold allowed for mutation calling and demonstrated that this did not impact the central findings of this study (Extended Data Fig. 5a,b). Third, we explicitly modeled the impact of CALR amplicon UMI in multivariable models (generalized linear model using R Stats package v3.5.1, e.g., pseudotime analysis), in which the number of amplicon UMI was included in the model alongside the mutation status (Extended Data Fig. 5c). We further note that the GoT procedure did not result in significant loss of genes or UMIs per cell in comparison to published data of CD34+ selected cells from the standard 10x library (Extended Data Fig. 3d)54. For XBP1 splicing analyses, we required a cell to have at least one unspliced XBP1 for inclusion in the analyses. ## Mutant cell frequency analysis For integrated analysis of ET01-ET05 or MF01-MF04, an equal number of cells from each sample (n = 900 for ET and n = 400 for MF) were subsampled randomly. Genotyping amplicon UMIs were downsampled (x100 iterations) to one per cell and mutant cell frequency was determined for each cluster for either the integrated dataset or individual samples. This frequency was then divided by the total mutant cell frequency across all progenitor subsets for each of the iterations (Figs. 1f,g, 4c, 5h, Extended Data Fig. 5d). ## Differential expression and gene set enrichment analysis For gene module analysis, the aggregate gene expression levels of modules of genes involved in biological processes of interest (see complete list of genes for each module in Supplementary Table 2) were calculated as log2 of the ratio of UMI in gene module per 10,000 UMIs per cell. The gene modules have been previously published (see references in main text and in Supplementary Table 2). Differential gene expression analysis between mutant and wildtype cells for each of the progenitor cluster for each patient was performed via the ‘FindMarkers’ function within the Seurat Package using the logistic regression for differential gene expression55 with variable genes as input and requiring expression in at least 10% of cells in either group. UMI was included as a latent variable. The differentially expressed genes were examined individually for each patient; they were also examined in combination for each cluster across the patients by combining the P-values for the differentially expressed genes via Fisher’s method and performing a weighted average of the log2(fold change) (Supplementary Table 3). Genes that were differentially expressed with FDR < 0.1 and log2(fold change) >= 0.2 were included for gene set enrichment analysis. Hypergeometric test for gene set enrichment analysis was performed using the gProfileR package (v. 0.6.7)56. Multiple hypothesis testing correction was performed using the g:SCS algorithm developed by the authors of the gProfileR package. KEGG, Reactome, GO:MF, and GO:BP data sources were included in the analyses (Supplementary Table 4). ## Comparison of mutant allelic fraction in whole exome sequencing (WES) and RNA-seq We compared the mutant allelic fractions between gDNA and RNA, estimated from WES and RNA-seq data, respectively, in five cancer cohorts (BRCA, breast invasive carcinoma; HNSC, head and neck squamous cell carcinoma; KIRC, kidney renal clear cell carcinoma; LUAD, lung adenocarcinoma; STAD, stomach adenocarcinoma). For this analysis, we thank Dr. Tae-Min Kim (Cancer Research Institute, College of Medicine, The Catholic University of Korea) for sharing the curated datasets based on his previous study57. In brief, the datasets of each cancer cohorts were initially prepared with somatic mutation sets that are reported from The Cancer Genome Atlas (TCGA) portal (https://portal.gdc.cancer.gov/). Then, reference and alternative alleles for these mutations were counted in bam files of WES and RNA-seq using SAMtools mpileup58, and filtered for >10 coverage of reads. We then converted genomic coordinates of the datasets from hg19 to hg38 assembly. To identify the frequencies of somatic mutations in cancers, we used the CNT values from CosmicCodingMuts.vcf (v86) in the Catalogue of Somatic Mutations in Cancer (COSMIC) database59. Then, we further annotated the variants as oncogene or tumor suppressor gene (TSG) (Vogelstein et al. 201360), and as driver or passenger mutations (Bailey et al. 201861). ## Determination of targeted loci distance from 3’ or 5’ ends of transcripts To identify Ensembl transcript ID (ENST) corresponding to each mutation in the datasets of five cancer cohorts described above, we matched them with COSMIC ID and annotated from the file of CosmicMutantExport.tsv (v86). We used the biomaRt R package62 with the GRCh38 version to annotate the transcript including the length of transcript and the position of cDNA start codon in the transcript. The positions of the 5’ untranslated region (UTR) ends were determined to calculate the distance from 5’ end to target site. ## Oxford Nanpore Technology (ONT) The cDNA amplicon samples were barcoded by ONT 1D native barcoding kit EXP-NBD104. The barcoded samples were fed into ONT SQK-LSK109 library preparation and sequencing workflow. FLO-MIN106 RevD flowcells and GridION X5 sequencer were used for sequencing. Data were basecalled by ONT Guppy 2.3.1. For analysis, the adaptor sequences were trimmed Porechop (https://github.com/rrwick/Porechop). Then, the reads were assessed for correct priming as shown in Extended Data Fig. 9d. The correctly primed reads were aligned to the reference genome (Grch38) with minimap263 (v. 2.16) for variant calling. The cell barcodes underwent the same processing described above for IronThrone GoT (Extended Data Fig. 9d, 10). ## Droplet digital PCR Peripheral blood from three ET patients with mutations in CALR underwent Ficoll density gradient separation, immunomagnetic selection for CD34+ cells (Miltenyi Biotech), and fluorescence-activated cell sorting (FACS) (Influx, Becton-Dickinson) using PeCy7-labeled CD34, clone 561 (lot# B257238, BioLegend), APC-labeled CD38, clone HIT2 (lot #B247250, BioLegend) and FITC-labeled CD10, clone HI10a (lot# B254556, BioLegend) antibodies were used to isolate CD34+CD38−, CD34+CD38+, and CD34+CD10+ cell compartments. DNA was extracted from sorted cells (Qiagen) and the VAF of CALR mutations was measured by droplet digital PCR (QX200 Droplet Digital PCR System, Bio-Rad) with primers that specifically detect CALR type 1 mutations (52-bp deletion (p.L367fs*46), CALR type 2 mutations (5-bp TTGTC insertion (p.K385fs*47) or wildtype alleles. ## Single cell colony genotyping assay Viably frozen mononuclear cells were thawed and plated in H4434 Methocultä media (StemCell Technologies, Cambridge, MA) containing recombinant human SCF, GM-CSF, IL-3 and EPO according to the manufacturer’s specifications. Individual colonies (n = 94) were picked from the methylcellulose media after 14 days of culture at 37°C and sequenced by Sanger sequencing for SF3B1, CALR and NFE2 mutations using primers listed in Supplementary Table 5. # Extended Data # Supplementary Material